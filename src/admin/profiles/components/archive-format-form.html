<accordion-group [isOpen]="expanded">
  <div accordion-heading>
    <h4>{{ archiveFormat.toString() }}</h4>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-horizontal">
    <sd-form-errors [errors]="formErrors()"></sd-form-errors>

    <div class="form-group">
      <div [class.has-error]="fieldErrors('initial_bitrate')">
        <label for="initial_bitrate" class="col-sm-3 control-label">Initiale Bitrate</label>
        <div class="col-sm-3">
          <div class="input-group">
            <select id="initial_bitrate" class="form-control" formControlName="initial_bitrate">
              <option *ngFor="let bitrate of audioEncoding.attributes.bitrates" value="{{bitrate}}">
                {{ bitrate }}
              </option>
            </select>
            <div class="input-group-addon">kbps</div>
          </div>
          <sd-field-errors [errors]="fieldErrors('initial_bitrate')"></sd-field-errors>
        </div>
      </div>

      <div [class.has-error]="fieldErrors('initial_channels')">
        <label for="initial_channels" class="col-sm-3 control-label">Initiale Anzahl Kanäle</label>
        <div class="col-sm-3">
          <select id="initial_channels" class="form-control" formControlName="initial_channels">
            <option *ngFor="let channel of audioEncoding.attributes.channels" value="{{channel}}">
              {{ channel }}
            </option>
          </select>
          <sd-field-errors [errors]="fieldErrors('initial_channels')"></sd-field-errors>
        </div>
      </div>
    </div>

    <div class="form-group" [class.has-error]="fieldErrors('max_public_bitrate')">
      <label for="max_public_bitrate" class="col-sm-3 control-label">Maximale öffentliche Bitrate</label>
      <div class="col-sm-3">
        <div class="input-group">
          <select id="max_public_bitrate" class="form-control" formControlName="max_public_bitrate">
            <option *ngFor="let bitrate of audioEncoding.attributes.bitrates" value="{{bitrate}}">
              {{ bitrate }}
            </option>
            <option value="0">Nicht öffentlich</option>
          </select>
          <div class="input-group-addon">kbps</div>
        </div>
        <sd-field-errors [errors]="fieldErrors('max_public_bitrate')" class="col-sm-6"></sd-field-errors>
      </div>
    </div>

    <div>
      <button type="submit"
              [disabled]="form.pristine || !form.valid"
              class="btn btn-primary title">
        Speichern
      </button>
      &nbsp;
      <button type="reset"
              (click)="reset()"
              [disabled]="form.pristine"
              class="btn">
        Zurücksetzen
      </button>
      &nbsp;
      <button (click)="remove($event)"
              class="btn btn-danger pull-right">
        Löschen
      </button>
    </div>
  </form>

  <div *ngIf="archiveFormat.id">
    <br/>

    <h4>Datenreduktion</h4>

    <sd-downgrade-action *ngFor="let action of downgradeActions"
                         [class.disabled]="!!editedDowngradeAction"
                         [downgradeAction]="action"
                         (edit)="editDowngradeAction(action)"
                         (remove)="removeDowngradeAction(action)">
    </sd-downgrade-action>

    <br/>

    <sd-downgrade-action-form *ngIf="editedDowngradeAction"
                              [downgradeAction]="editedDowngradeAction"
                              [audioEncoding]="audioEncoding"
                              [restService]="downgradeActionsRest"
                              (saved)="updateDowngradeAction($event)"
                              (canceled)="editedDowngradeAction = undefined">
    </sd-downgrade-action-form>

    <div *ngIf="!hasEreasingDowngrade() && !editedDowngradeAction">
      <a (click)="addDowngradeAction(false)">Reduktionsschritt hinzufügen</a>
      /
      <a (click)="addDowngradeAction(true)">Löschzeitpunkt hinzufügen</a>
    </div>
  </div>

</accordion-group>
